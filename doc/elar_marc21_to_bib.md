# Формирование полей

Все атрибуты - это строки, за исключением некоторых, где указан другой тип.

## Атрибуты идентификаторов документа

- `id` - Системный номер - 001 - уникальный номер записи в РГБ (как строка!) Например "004673635"

- `cat` - Каталог, например "rsl01"

- `regnum` - Регистрационный номер - 017a - номер Российской книжной палаты (РКП)

- `isbn` - ISBN - 020a, 020z - международные стандартные книжные номера

- `issn` - ISSN - 022a, 022y, 022z - международные стандартные сериальные номера

- `storage_code` - Шифр хранения - 534l, 852a, 852b, 852j, 852h

- `siglafund` - Сигла фонд - 852b

- `id+cat+regnum+isbn+issn+storage_code` - Идентификатор документа - 001, 017a, 020a, 020z, 022a, 022y, 022z, 534l, 852a, 852b, 852j - обобщающий: системный номер, регистрационный номер, ISBN, ISSN, шифр хранения

## Атрибуты: автор, заглавие, серия

- `author` - Автор - 100a, 100c, 110a, 110b, 111a, 111q, 245c, 505r, 550a, 700a, 700c, 710a, 710b, 711a, 711q, 720a, 773a - имена индивидуальных авторов и наименования коллективных авторов(организаций), составителей и других лиц, участвовавших в подготовке документа

- `author1` - Автор1 - 100a, 100c, 110a, 110b, 111a, 111q, 245c - подмножество поля Автор

- `author2` - Автор2 - 773a, 700a, 700c, 710a, 710b, 711a, 711q, 720a - подмножество поля Автор

- `author3` - Автор3 - 505r, 550a, 505g - подмножество поля Автор

- `title` - Заглавие - 245a, 245b, 246a, 130a, 240a, 242a, 242b, 247a, 247b, 505t, 100t, 110t, 111t, 700t, 710t, 711t, 730a, 740a, 245p, 773t, 490a, 440a - заглавия произведений, сборников и серий

- `title1` - Заглавие1 - 245a, 246a, 130a, 240a, 242a, 247a, 110t, 111t - подмножество поля Заглавие

- `title2` - Заглавие2 - 773t, 700t, 710t, 711t, 730a, 740a, 490a, 440a - подмножество поля Заглавие

- `title3` - Заглавие3 - 245b, 245p, 246b, 246p, 242b, 247b, 505t, 730p - подмножество поля Заглавие

- `series` - Серия - 490a, 440a - наименования книжных серий

## Атрибуты выходных данных

- `pub_place` - Место издания - 260a, 260e, 534c, 752d, 773d - названия соответствующих городов

- `pub_house` - Издательство - 260b, 260f - наименования издательств

- `pub_place+pub_house` - Выходные данные - 260a, 260e, 534c, 752d, 773d, 260b, 260f - обобщающий: место издания + издательство

- `pubyear` - Год издания - 260c, 534c, 901b - как целое число

Атрибуты содержания

- `theme` - Предмет(тема) - 600a, 600c, 610a, 610b, 611a, 611q, 630a, 650a, 650b, 651a, 653a - наименования делений(рубрик) классификации(ББК), ключевые слова, персоналии, организации, георафические названия и мероприятия, упоминающиеся в документе

- `persona` - Персоналии - 600a, 600c - имена лиц, о которых говорится в документах

- `note` - Аннотация - 520a - аннотация к документу

- `theme+note` - Содержание - 600a, 600c, 610a, 610b, 611a, 611q, 630a, 650a, 650b, 651a, 653a, 520a - обобщающий: предмет документа, аннотация

- `keyword` - Ключевые слова - 653a

## Дополнительные атрибуты

- `bbk` - Индекс ББК - 084a

- `udk` - Индекс УДК - 080a, 080x

- `lang` - Язык - 041a - цифровой код по ГОСТ 7.75-97

- `organization` - Организация - 110a, 110b, 610a, 610b, 710a, 710b, 533c, 550a

- `person_name` - Имя лица - 100a, 100c, 245c, 505r, 600a, 600c, 700a, 700c, 773a - имена лиц вне зависимости от их роли по отношению к публикации (авторы, персоналии, составители, редакторы, иллюстраторы и т.д.)

- `action` - Мероприятие - 111a, 111q, 611a, 611q, 711a, 711q - наименования конференций, симпозиумов, семинаров, выставок и т.д.

- `vak_code` - Номер специальности ВАК - 072a - таксономический атрибут

- `citation` - Цитирование/ссылки - 510a, 510c, 510x - примечание, цитирующее или отсылающее к опубликованным библиографическим изданиям

## Анализаторы

Анализатор для полей byAuthor, byTitle Представляет входную строку как единый токен, преобразует её в нижний регистр, убирает повторяющиеся и крайние пробелы, заменяет 'ё' на 'е' и обрезает получившийся токен до заданной максимальной длины.

Анализатор для полей storage_code Представляет входную строку как единый токен, убирает крайние пробелы и преобразует её в нижний регистр.

Анализатор для полей isbn Представляет входную строку как единый токен и, в случае если это ISBN-10, преобразует её в ISBN-13. Если преобразование невозможно, то возвращает входную строку.

Анализатор для полей issn Представляет входную строку как единый токен и, по возможности, преобразует к виду "\\d{4}\\-\\d{3}(\\d|X)". Если преобразование невозможно, то возвращает входную строку.

Анализатор для полей title, note, theme, keyword, citation, series, card Разбивает входную строку на токены в соответствие с грамматикой Tokenizer1Impl.jflex, преобразует их в нижний регистр, выделяет словоформы для русского и английского языка и сохраняет исходную форму с префисом '$'.

Анализатор для полей content Разбивает входную строку на токены в соответствие с грамматикой ContentTokenizerImpl.jflex с ограничением минимальной длины токена, преобразует их в нижний регистр, выделяет словоформы для русского и английского языка без сохранения исходной формы, применяет фильтрацию по т.н. стоп-словам, применяет специальную фильтрацию по особым образом составленному словарю.

## Веса атрибутов

author1 = 25 author2 = 17.5 author3 = 7.5 title1 = 10 title2 = 8 title3 = 5 card = 3 content = 1

# Алгоритм формирования краткого БО для библиографических записей в формате MARC21

Краткое БО формируется через промежуточную структуру CardInfo. Т.е.
сначала формируется структура CardInfo, а, затем, путём комбинирования
её полей - краткое БО.
В приведённом ниже алгоритме не учтены детали реализации вроде
проверки наличия полей, и не показано HTML форматирование.
Формирование краткого БО
```
=CardInfo.heading+'.'
+
CardInfo.title+' / '+CardInfo.responsibility+'. -
'+CardInfo.edition+'. - '+CardInfo.imprint+'. - '+CardInfo.physical+
'. - '+CardInfo.series+' // '+CardInfo.analit+'.'+CardInfo.vol+';
'+CardInfo.isbn+'; '+CardInfo.issn
+
CardInfo.note+CardInfo.contents+'Хранение: '+CardInfo.location+';
```

## Формирование структуры CardInfo

Структура CardInfo - Информация из библио описания

### Поля структуры

| Тип    | Название поля | Назначение |
| ------ | ------------- | ---------- |
| строка | heading | Заголовок |
| строка | title | Заглавие |
| строка | author | Автор |
| строка | responsibility | Сведения об ответственности |
| строка | edition | Издание |
| строка | imprint | Выходные данные |
| строка | physical | Физическая характеристика |
| строка | isbn | ISBN |
| строка | issn | ISSN |
| строка | vol | Том |
| строка | series | Серия, выпуск |
| список | note | Примечание |
| список | contents | Содержание |
| список | location | Хранение |
| строка | analit | Сведения об издании, в котором помещена часть |

## Алгоритм формирования CardInfo

Алгоритм формирования CardInfo состоит из двух частей: одной в зависимости от
библиографического уровня и общей части.

- Если библиографический уровень (символ в позиции 7 маркера) равен
a или b – см. Формирование CardInfo. Монографическая составная часть,
Сериальная составная часть продолжающегося ресурса
- иначе, если существует поле 773 – см. Формирование CardInfo. Составная
часть библиографической единицы
- иначе – см. Формирование CardInfo. Остальное
- Далее см. Формирование CardInfo. Общая часть

## Формирование CardInfo. Монографическая составная часть, Сериальная составная часть продолжающегося ресурса

- Сведения о составной части издания
  - Заголовок индивидуального автора
    - CardInfo.author=100a
    - CardInfo.heading=100a+' '+100b+' ('+100c+'; '+100d+')'
  - Или Заголовок коллективного автора
    - CardInfo.heading=110a+'. '+110b+' ('110d+'; '+110c+'). '+110t
  - Или Заголовок мероприятия
    - CardInfo.heading=111a+'. '+111e+' ('+111n+'; '+111d+';
'+111c+')'
  - Заглавие и сведения об ответственности
    - CardInfo.title=245a+'. '+245n+'.'+245p+' ['+245h+'] : '+245b+'
: '+245k+', '+245f
    - CardInfo.responsibility=245c
- Сведения об издании, в котором помещена часть
    - CardInfo.analit=773a+'. '+773t+'. - '+773b+'. - '+773d+'. -
'+773g+'. - '+300a+' : '+300b+'. - '+773k


## Формирование CardInfo. Составная часть библиографической единицы

- Заголовок
  - CardInfo.heading=773a
- Заглавие и сведения об ответственности
  - CardInfo.title=773t
- Сведения об издании
  - CardInfo.edition=773b
- Выходные данные
  - CardInfo.imprint=773d
- Количественная характеристика
  - CardInfo.physical=773h
- Серия
  - CardInfo.series=773k
- Спецификация
  - Если нет 245a или 773g != 245a, то CardInfo.vol=773g
- Заглавие и сведения об ответственности тома
  - CardInfo.vol+=': '+245a+'. '+245n+' ['+245h+'] : '+245b+' :
'+245k+', '+245f+' / '+245c
- Выходные данные тома
  - CardInfo.vol+=': '+260a+': '+260b+', '+260c+' ('+260e+' :
'+260f+', '+260g+')'
- Количественная характеристика тома
  - CardInfo.vol+=': '+300a+' : '+300b+'; '+300c+' + '+300e

## Формирование CardInfo. Остальное

 - Заголовок
   - Заголовок индивидуального автора
     - CardInfo.author=100a
     - CardInfo.heading=100a+' '+100b+' ('+100c+'; '+100d+')'
   - Или Заголовок коллективного автора
     - CardInfo.heading=110a+'. '+110b+' ('110d+'; '+110c+'). '+110t
   - Или Заголовок мероприятия
     - CardInfo.heading=111a+'. '+111e+' ('+111n+'; '+111d+';
'+111c+')'
   - Или Заголовок унифицированного заглавия
     - CardInfo.heading=130a+'. '+130n+' ['+130h+']. '+130k+'.
'+130s+' ('+130f+')'

 - Область библиографического описания
   - Заглавие и сведения об ответственности
     - CardInfo.title=245a+'. '+245n+'.'+245p+' ['+245h+'] : '+245b+'
: '+245k+', '+245f
     - CardInfo.responsibility=245c
   - Сведения об издании
     - CardInfo.edition=250a+' / '+250b
   - Выходные данные
     - CardInfo.imprint=Список( '. - '+260a+': '+260b+', '+260c+'
('+260e+' : '+260f+', '+260g+')' )
   - Количественная характеристика
     - CardInfo.physical='. - '+300a+' : '+300b+'; '+300c+' + '+300e
   - Серия
     - CardInfo.series=Список( '. - ('+440a+', ISSN '+440x+';
'440v+')' )
     - CardInfo.series=Список( '. - ('+490a+', ISSN '+490x+';
'490v+')' )


## Формирование CardInfo. Общая часть

 - CardInfo.isbn=('ISBN ' + 020a + ' : ' + 020c)
 - CardInfo.issn=('ISSN ' + 022a)
 - CardInfo.note=Список всех подполей 500,505,520,534
 - CardInfo.contents=Список полей (650a+' '+650b+' - '+650v+' -
'+650x+' - '+650y+' - '+650z)
 - CardInfo.contents=Список полей (653a через ' - ')
 - CardInfo.location=Список полей (852b+' '+852h+'; '+852i+'; '+852j)
 - CardInfo.url=856u
